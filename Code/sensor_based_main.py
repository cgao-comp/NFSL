import numpy as np
import setproctitle

import create_graphs
from GG_train import *
import random
import networkx as nx

import processing16
from processing16 import DataReader

def optimized_bot_deploymentv1(G, xi):

    
    O = set()

    
    K = sorted(G.nodes(), key=lambda x: G.degree(x), reverse=True)

    while len(O) <= len(G.nodes()) * xi:
        
        o = next(node for node in K if node not in O)
        O.add(o)

        
        E_o = nx.eccentricity(G, o)

        
        for n in range(1, E_o + 1):
            print(len(O))
            neighbors_n = {node for node in nx.single_source_shortest_path_length(G, o, cutoff=n) if
                           nx.shortest_path_length(G, o, node) == n}
            neighbors_n = neighbors_n - O  

            
            if neighbors_n:
                o_prime = max(neighbors_n, key=lambda x: G.degree(x))
                O.add(o_prime)

    return O


def optimized_bot_deploymentv2(G, xi):
    def bfs_nodes_at_distance(G, source, distance):

        visited = set([source])
        queue = [(source, 0)]  

        nodes_at_distance = set()

        while queue:
            current_node, current_distance = queue.pop(0)

            
            if current_distance > distance:
                break

            
            if current_distance == distance:
                nodes_at_distance.add(current_node)

            for neighbor in G.neighbors(current_node):
                if neighbor not in visited:
                    visited.add(neighbor)
                    queue.append((neighbor, current_distance + 1))

        return nodes_at_distance



    
    O = set()

    
    K = sorted(G.nodes(), key=lambda x: G.degree(x), reverse=True)

    while len(O) <= len(G.nodes()) * xi:
        
        o = next(node for node in K if node not in O)
        O.add(o)

        
        E_o = nx.eccentricity(G, o)

        
        for n in range(1, E_o + 1):
            print(len(O))
            neighbors_n = bfs_nodes_at_distance(G, o, n)
            neighbors_n = neighbors_n - O  

            
            if neighbors_n:
                o_prime = max(neighbors_n, key=lambda x: G.degree(x))
                O.add(o_prime)

    return O

def optimized_bot_deployment_rigorous(G, xi):


    
    O = set()

    
    K = sorted(G.nodes(), key=lambda x: G.degree(x))
    K_MAX = sorted(G.nodes(), key=lambda x: G.degree(x), reverse=True)

    while len(O) <= len(G.nodes()) * xi:
        d = 1
        visited_set = set()

        
        original_min = None
        if random.random() < 0.05:
            original_min = next(node for node in K_MAX if node not in O)
        else:
            original_min = next(node for node in K if node not in O)


        O.add(original_min)
        visited_set.add(original_min)

        current = original_min
        print('original_min: ', G.degree(original_min))
        while True:
            
            neighbors = set(G.neighbors(current))
            neighbors_next_hop = neighbors - visited_set
            neighbors_next_hop_useful = neighbors_next_hop - O
            for nei in neighbors:
                visited_set.add(nei)

            neighbors_next_hop_useful_distancecorrect = set()
            if neighbors_next_hop_useful:
                
                if d == 1:
                    neighbors_next_hop_useful_distancecorrect = neighbors_next_hop_useful
                else:
                    neighbors_next_hop_useful_distancecorrect = {ele for ele in neighbors_next_hop_useful if
                                                 nx.shortest_path_length(G, source=original_min, target=ele) == d}

                

                d = d + 1

            
            if neighbors_next_hop_useful_distancecorrect:
                current = max(neighbors_next_hop_useful_distancecorrect, key=lambda x: G.degree(x))
                O.add(current)
                visited_set.add(current)

                distance = nx.shortest_path_length(G, source=original_min, target=current)
                print('preceesor_max: ', G.degree(current), '以及距离: ', distance)
            else:

                break

    return O


def optimized_bot_deployment_rigorousv2(G, xi):

    
    O = set()

    
    K = sorted(G.nodes(), key=lambda x: G.degree(x))
    K_MAX = sorted(G.nodes(), key=lambda x: G.degree(x), reverse=True)

    while len(O) <= len(G.nodes()) * xi:
        d = 1
        visited_set = set()

        
        original_min = None
        if random.random() < 0.05:
            original_min = next(node for node in K_MAX if node not in O)
            print('original_max: ', G.degree(original_min))
        else:
            original_min = next(node for node in K if node not in O)
            print('original_min: ', G.degree(original_min))


        O.add(original_min)
        visited_set.add(original_min)

        current = original_min

        while True:
            
            neighbors = set(G.neighbors(current))
            neighbors_next_hop = neighbors - visited_set
            neighbors_next_hop_useful = neighbors_next_hop - O
            for nei in neighbors:
                visited_set.add(nei)

            flag = False
            for node in K_MAX:
                if node not in O and node in neighbors_next_hop_useful:
                    distance = nx.shortest_path_length(G, source=original_min, target=node)
                    if distance == d:
                        current = node
                        O.add(current)
                        visited_set.add(current)
                        print('preceesor_max: ', G.degree(current), '以及距离: ', distance, '现在数量: ', len(O))
                        flag = True
                        break

            if flag == False:
                break
            else:
                d = d + 1

    return O

def optimized_bot_deployment_fast(G, xi):

    O = set()

    
    K = sorted(G.nodes(), key=lambda x: G.degree(x))
    K_MAX = sorted(G.nodes(), key=lambda x: G.degree(x), reverse=True)

    while len(O) <= len(G.nodes()) * xi:
        d = 1
        visited_set = set()

        
        original_min = None
        if random.random() < 0.05:
            original_min = next(node for node in K_MAX if node not in O)
        else:
            original_min = next(node for node in K if node not in O)


        O.add(original_min)
        visited_set.add(original_min)

        current = original_min
        print('original_min: ', G.degree(original_min))
        while True:
            
            neighbors = set(G.neighbors(current))
            neighbors_next_hop = neighbors - visited_set
            neighbors_next_hop_useful = neighbors_next_hop - O
            for nei in neighbors:
                visited_set.add(nei)

            
            if neighbors_next_hop_useful:
                current = max(neighbors_next_hop_useful, key=lambda x: G.degree(x))
                O.add(current)
                visited_set.add(current)

                distance = nx.shortest_path_length(G, source=original_min, target=current)
                print('preceesor_max: ', G.degree(current), '以及距离: ', distance)
            else:

                break

    return O



def source_localization(G, bot_useful_info_dict, O_Y, O_N, features):

    if len(bot_useful_info_dict) == 0:
        print('无法定位')
        return -999

    
    for bot, info in bot_useful_info_dict.items():
        if info['infection_time'] == 0:
            print('太简单了')
            
            return -999

    def compute_t_o(bot_info, omega_pos, omega, omega_neg):
        t_o_minus = bot_info['infection_time']
        min_t_o_minus = min([info['infection_time'] for info in bot_useful_info_dict.values()])

        if t_o_minus >= 6:
            return t_o_minus - min_t_o_minus + omega_pos
        elif t_o_minus >= 4:
            return t_o_minus - min_t_o_minus + omega
        else:
            return t_o_minus - min_t_o_minus + omega_neg

    def compute_otimes(t_o, d_o_v):
        return max(t_o / d_o_v, d_o_v / t_o)

    def compute_rp(v, O_Y, O_N, rho1, rho2):
        neighbors = set(G.neighbors(v))
        intersect_Y = neighbors.intersection(O_Y)
        intersect_N = neighbors.intersection(O_N)

        if intersect_Y:
            return rho1 ** len(intersect_Y)
        else:
            return rho2 ** len(intersect_N)

    def compute_psi_norm(G, A, gamma, features):

        degrees = np.array(G.degree())[:, 1]

        
        D_inv_sqrt = np.diag(1.0 / np.sqrt(degrees))
        norm_A = D_inv_sqrt @ (A + gamma* np.ones(len(G.nodes))) @ D_inv_sqrt

        
        F = np.array([features[v]['inf'] for v in G.nodes]).T  

        return norm_A @ F

    def compute_psi_fast(v, G, gamma=0.01):
        
        v_inf = G.nodes[v]['inf']

        
        neighbors_inf_values = [G.nodes[neighbor]['inf'] for neighbor in G.neighbors(v)]

        
        if neighbors_inf_values:  
            avg_neighbor_inf = sum(neighbors_inf_values) / len(neighbors_inf_values)
        else:
            avg_neighbor_inf = 0.00001

        
        final_influence = 0.5 * v_inf + 0.5 * avg_neighbor_inf
        return 1/(gamma*final_influence+1)

    def punishment_score(v, bot_useful_info_dict, O_Y, O_N, features, rho1=0.99, rho2=1.01, omega_pos=3, omega=2, omega_neg=1):
        total_d = 0
        total_otimes = 0

        for o, info in bot_useful_info_dict.items():
            infected_by = info['infected_by'][0][0]  
            d_o_v = nx.shortest_path_length(G, source=infected_by, target=v) + 1
            t_o = compute_t_o(info, omega_pos, omega, omega_neg)
            otimes = compute_otimes(t_o, d_o_v)

            total_d += d_o_v
            total_otimes += otimes

        return (total_d ** 0.75) * (total_otimes ** (2/3)) * compute_rp(v, O_Y, O_N, rho1, rho2) * compute_psi_fast(v, G)

    
    V_theta = set()
    for bot in O_Y:
        
        one_hop = set(nx.neighbors(G, bot))
        V_theta.update(one_hop)
        
        
        
        
    
    V_theta = V_theta - O_Y
    print('这一轮参与的candidate: ', len(V_theta))


    
    scores = {v: punishment_score(v, bot_useful_info_dict, O_Y, O_N, features) for v in V_theta}  
    
    
    return min(scores, key=scores.get)



if __name__ == '__main__':
    
    args = Args()
    rumor_cascade, union_graph_inf = create_graphs.create_graph1(args)
    print(len(rumor_cascade))
    print(union_graph_inf)

    
    
    
    bots={721062796604153856, 722167995771002881, 708113510472015873, 723024339075915777, 712091107409068033, 713103325244227585, 702898075086495745, 705908049932918785, 743931428132560898, 464142339, 723036693289263105, 4262682632, 703747970756427780, 750321542320586756, 1717182481, 2274926610, 131121173, 569368598, 585654298, 2433253403, 397082652, 328097823, 18587683, 856195111, 1356406826, 23035948, 314261556, 1473495092, 117751861, 15474740, 2165596217, 44736578, 357515333, 188080199, 68182087, 131096656, 3324379221, 21610581, 187351126, 341827679, 325492834, 16834659, 16146535, 505995369, 3247308906, 457171051, 22724717, 2919145584, 1616248951, 535093370, 90071164, 270147709, 308191356, 28180607, 198500480, 513876097, 185950340, 1402978436, 65675400, 848076936, 374882442, 15384713, 330678412, 208142477, 332955791, 2579800207, 232120463, 35004562, 1934950548, 1831461018, 234365083, 2401632410, 76087454, 836305056, 3400253603, 255787180, 307478701, 120209587, 503603385, 3906175166, 43720896, 1242685638, 14721226, 40272074, 8044752, 216154321, 74186967, 238969051, 459808988, 28066013, 84713692, 112517348, 2366365927, 87081194, 952164589, 2582888688, 2930262258, 336904434, 333603060, 41615605, 54771958, 39076082, 2350784760, 15311104, 2883841, 516030722, 161177856, 93118728, 283762958, 61776145, 17572116, 35619095, 45285656, 3022045469, 261226791, 589201706, 37159211, 99000621, 2421621042, 298647861, 876740917, 22192440, 305496377, 17899834, 187007293, 171802941, 34939208, 1602797906, 27189587, 409878867, 2847777110, 2829967711, 1030955364, 419037545, 52527466, 307413358, 1932124526, 177152378, 534569340, 33710461, 22053247, 2474819971, 890872201, 2425231, 32670098, 388481436, 1489486238, 9609632, 2097571, 17187236, 3073753508, 594198947, 2367911, 28246439, 752206248, 3363512746, 341795241, 1037885868, 501825960, 256164270, 3351519664, 259293617, 1257841076, 410853815, 150135224, 514671033, 3164611003, 41976254, 68272579, 18981319, 55075272, 190800327, 1901273544, 2162983369, 8839632, 560972241, 57115089, 179634643, 734912982, 2960949718, 103186907, 2936652259, 5644772, 217489891, 158228967, 3300205033, 138199530, 218505708, 846602737, 18874870, 262332918, 742121977, 134603258, 43287033, 2566087161, 3120202241, 2657165830, 1584660998, 3297362441, 2185257481, 167535120, 330031635, 3282559508, 946995733, 773440021, 1960878613, 191701524, 304783896, 538370581, 1290117662, 2224087584, 3347317282, 84214307, 1598210598, 911598120, 2489680425, 313385516, 362144301, 1190765102, 3987292719, 1581204018, 41042486, 63529527, 1888969274, 1120272962, 219488834, 435077701, 19628613, 68280903, 28230213, 198468169, 1566335562, 1862238794, 210174544, 3859128913, 443949651, 108814937, 134971995, 2836341340, 36266589, 82264670, 245523038, 51241574, 182911593, 74498666, 177070701, 18244206, 29704815, 2895094386, 90129011, 597697138, 196379254, 574022262, 58770047, 145883775, 363774592, 512623234, 14377605, 3131581065, 563995277, 60039822, 391471763, 40116885, 275751576, 587727514, 25911963, 384410267, 115589788, 845759130, 41714335, 2803786405, 962773670, 219038377, 15483562, 22119084, 2598544044, 164242095, 2206450351, 517817016, 126665405, 32441022, 1520239297, 2246632129, 2217394882, 12993222, 2465006282, 185959122, 344212178, 19636948, 24486612, 19038934, 43573974, 538370777, 398041817, 29246171, 126804702, 434545375, 824951520, 273597159, 71082732, 60089073, 2202518265, 31515385, 2168300284, 57041662, 704539519043788800, 2747515651, 310092548, 926991108, 720339929608249345, 2759123720, 703767307, 2269561615, 3146875664, 335586066, 39707411, 3074360084, 534987542, 125240090, 342885148, 14934818, 1917731, 15737637, 28156710, 4148118318, 261776174, 2328109872, 617825073, 795448, 17752889, 134619961, 2904040253, 953492287, 2426577733, 624010054, 17367879, 1328767814, 268002126, 63300433, 2256159571, 1406346067, 551576409, 98976602, 567583579, 343098207, 7848802, 60113766, 17474417, 80388979, 37602163, 57377653, 529564536, 633062266, 1159955323, 555287426, 455394184, 881124234, 3386155917, 3166929806, 2974778260, 2409292693, 75318169, 3307946912, 456385445, 16343974, 623117224, 69706668, 47850420, 163709877, 1618641848, 229491643, 14894013, 1724228557, 280224718, 764724176, 915137490, 40461273, 272114651, 354010083, 531629036, 543663086, 277685231, 375374833, 417965044, 226649076, 998679542, 287024119, 61162489, 711164924, 62014464, 20194311, 2904482824, 588727305, 24708106, 57762831, 305275926, 2506875931, 2707317787, 9651232, 2972492833, 844751911, 239510568, 15754281, 15811625, 2961204267, 385213484, 49882156, 559023147, 255288363, 1556620338, 179471412, 46736437, 94143540, 3774694455, 444556346, 1090069562, 1347667004, 27403326, 1264215103, 21070914, 19915842, 23921732, 583427140, 610313289, 2925061194, 35398730, 606012492, 2936489040, 75105364, 18646108, 2992596062, 149406818, 507905123, 358483051, 221463677, 1354589310, 2821497982, 21398656, 594183296, 149709953, 2481636482, 14173315, 524657792, 163505280, 246572167, 1890829446, 22480002, 49800332, 827245711, 26789007, 31114386, 1247503507, 15164565, 319276183, 360662168, 21251225, 3187295388, 29230237, 2884771, 3600098475, 1305765036, 319833263, 463889585, 36553908, 156337335, 529949883, 3313640636, 3594364096, 145900738, 80372931, 134292677, 1018225862, 558982342, 10929352, 1146946760, 1939752139, 2574001358, 236487888, 7587032, 1379288282, 437994716, 32466146, 53503202, 32195814, 350045415, 133113066, 535659759, 192169201, 3222471924, 129041652, 27297014, 2316510456, 567928070, 2809390343, 16041234, 242779416, 826975513, 43869469, 448537890, 178717989, 317785386, 41559339, 1965450540, 19817778, 15549747, 864150841, 63251769, 70804796, 617407806, 2678048063, 302245185, 1067771203, 1138140488, 952853833, 171656520, 635053388, 633832781, 15074642, 91768149, 2691032407, 300410202, 335111517, 176489824, 4429587809, 1338418530, 872023394, 23995748, 21742949, 179758441, 51316075, 110396781, 1948370293, 168772982, 291349884, 327689598, 720517241977090048, 205186433, 33138053, 366355851, 60474764, 107210124, 1530832272, 537904539, 13215132, 403899803, 2715018653, 2944173472, 126903716, 2525906341, 755113, 146408874, 2689574322, 409241017, 81323453, 2794931646, 3646911, 387769793, 103122372, 377800132, 3341641162, 397673930, 40150478, 2716100047, 39552467, 28288468, 22930902, 83797466, 303285723, 58607069, 533644766, 151807455, 29926886, 44910060, 1355662832, 166528498, 1339835893, 16311797, 2828690934, 82224636, 604014076, 392783363, 145434131, 421414419, 55076373, 979887638, 27051544, 141682204, 3819390493, 392750627, 2318878244, 794658343, 216180269, 491914798, 572278319, 2753758769, 30320177, 328967731, 266102331, 49415744, 47253057, 427722309, 23504456, 143427151, 19949136, 2557521, 1863198290, 337626709, 21612122, 2935416411, 2828306011, 3522283105, 1317865058, 352396899, 219752036, 4580214373, 34113126, 2281047649, 321635949, 832120430, 3075933807, 2393433713, 3351357045, 382740085, 58074747, 110855805, 705549682177658880, 2304239234, 703327909319200768, 583288452, 4714915461, 18089606, 2439841414, 2957624968, 54322823, 1463297676, 747660943, 373835415, 47105689, 558253722, 97994396, 251881119, 2242152098, 2851104422, 37422758, 52889257, 19310250, 453265065, 35767980, 282371758, 425363123, 600532659, 239208121, 1395910332, 18769597, 913974974, 290703039, 7358142, 1862649541, 86345419, 618710736, 132245201, 2178975440, 26724052, 73475798, 2832344793, 948553442, 1140451, 48350950, 2820916967, 508110571, 20178671, 32466675, 4416702196, 2303993588, 232851192, 7309052, 19146492, 3165447940, 377693957, 62195462, 17082120, 38774539, 69699341, 232269582, 713549582, 1373882130, 116451098, 3257591580, 70477603, 1013352230, 625952550, 603785003, 233293612, 80848685, 22300463, 2461452080, 49702710, 1692174140, 2777663295, 41862980, 36546379, 962529102, 213067601, 549332823, 393758557, 840435552, 522667876, 119637864, 465872744, 37685101, 410937199, 272107377, 744154994, 519415667, 146261876, 115754870, 86861687, 151594872, 614705017, 337012602, 39749500, 640893, 1299769218, 275457923, 279390084, 17983365, 713444696996114433, 714975429476675585, 192161672, 1697073030, 424798092, 4855687055, 3425970072, 2347771802, 2251179930, 58853276, 2980186012, 258090911, 1242613664, 159958945, 386672549, 2365237161, 604932009, 2150221739, 1376012203, 1332881322, 146851759, 427878325, 29239222, 51062710, 467576758, 423561145, 513386426, 19843008, 2836421, 18671559, 1892173770, 18524109, 2467791, 277743569, 619579345, 2597464028, 2679875550, 462104542, 38316003, 1864673251, 2721335267, 95512551, 293857260, 138569710, 17270769, 706110837291810816, 278349834, 700720920218894338, 304613390, 7702542, 20645902, 14075928, 3035236380, 494135333, 28919847, 788524, 240846894, 273410096, 51202097, 17926194, 1262127157, 2554652730, 565069884, 69969989, 52594757, 312248392, 252102732, 69355601, 757712983, 4862339163, 53725284, 3418466404, 1548576871, 402425960, 16664681, 45713517, 2483136622, 105097331, 309643383, 611559544, 10774652, 141764741, 57673863, 5392522, 39831695, 5695632, 1071376531, 2218616982, 2612971670, 40601752, 547801241, 185895066, 990447774, 611338398, 629811359, 935266471, 20523175, 31353002, 24635564, 38226099, 3012700344, 37595323, 22956220, 137480382, 266832065, 563849409, 14559428, 81856710, 2726652103, 4320168139, 1597507790, 1249380560, 574023889, 526461138, 2567842008, 3304212699, 750700764, 3296684255, 335972576, 161868002, 30583013, 1584236773, 40863976, 594209001, 22153452, 472221936, 172869874, 167446775, 151243000, 1606592767, 1541949696, 247556352, 539240707, 21268744, 14690573, 875809039, 413640977, 444983577, 1397762330, 2160314652, 599009565, 3068471583, 3102525728, 134252835, 3395782949, 17869094, 9300262, 1018603818, 1669646636, 428333, 911460654, 1052854573, 475334960, 2432870707, 102689081, 278546748, 61147453, 3349309758, 204007744, 22522181, 603900230, 398731591, 1421969736, 126019912, 23046474, 317892941, 2871699791, 131156304, 2881644879, 218646869, 3742165340, 169150812, 1509443935, 3386706274, 48875877, 597641575, 860621168, 3285330289, 182577520, 1729890672, 501836155, 26487169, 517892482, 3304796160, 1734519186, 139667862, 805972376, 1269541274, 745064858, 3160648094, 86141342, 56412577, 389188004, 2392197547, 49031595, 54700463, 36800945, 158591411, 930245052, 500173247, 309184959, 2807859648, 92760512, 1829321, 80185804, 46483917, 245688789, 262474200, 1464560094, 9112032, 303262177, 718768609, 601770467, 151194085, 117647857, 205629938, 14780915, 827738611, 1305831925, 416311798, 1391446531, 17697300, 1762970136, 1078569498, 2494736924, 1022847523, 263432742, 578742822, 205072937, 41888303, 98757167, 1244932658, 49351221, 121793078, 203344437, 4293945912, 959121979, 2465057341, 311208510, 16116288, 310823490, 550488648, 1310984786, 2882390612, 35326548, 457984599, 109464151, 430115421, 15108702, 127289951, 3186903648, 565635679, 609897057, 767036004, 1074162278, 86633063, 2523556454, 384576105, 30902890, 893856362, 156863085, 49465966, 1717234290, 3240897141, 1337297528, 61942394, 323840634, 15264378, 19925631, 35302015, 252881540, 1473071750, 3315935882, 1580157583, 72477328, 857320088, 196168350, 3010923167, 18999969, 309865123, 80620197, 57158315, 27789999, 2159954610, 2862852788, 3306629815, 6433472, 45157061, 391097029, 2292796112, 22219473, 1450978002, 133737173, 318851803, 127724253, 76679905, 946465506, 494422755, 2423614184, 402098922, 351709930, 37120752, 846678769, 16206579, 22866675, 620530422, 176311034, 20630269, 248335104, 162204416, 139897603, 2413202180, 455764741, 233835272, 2698644240, 270535444, 78957338, 494283547, 74361628, 484477723, 409660188, 20867867, 34310945, 19245863, 320473895, 2918026026, 2761050928, 283626290, 322931507, 257796916, 254831413, 1007889204, 105106236, 582888253, 485346113, 759376705, 2464975682, 376965956, 844057416, 382896970, 770394956, 2831887184, 1043557206, 328878936, 344165209, 591940440, 21449569, 148622179, 211061613, 341584750, 81718129, 2370415474, 74287988, 1275997044, 332614520, 129092474, 3272788862, 33270656, 2242866050, 1372351364, 431917957, 128805784, 35564440, 2631609244, 309357470, 180317088, 1122249637, 14486438, 15395753, 256912302, 66071474, 1685425075, 14306228, 233073589, 154667959, 459099064, 112855999, 24357823, 525986755, 190098375, 1733798858, 3266243538, 1212689364, 1536617431, 3307277274, 578612187, 32345052, 3085781986, 1651067880, 227142637, 21621749, 2907311095, 67030010, 220736507, 502934525, 216583166, 82447359, 22678533, 721185798, 2899561478, 75688966, 931113992, 331926536, 2440186891, 16190478, 467004431, 1310944274, 554478610, 31288340, 2571578392, 1898343457, 24923175, 415067180, 169135151, 513018928, 23727153, 383020081, 48704562, 19295284, 774515766, 391113782, 1431530552, 524676152, 1007774779, 1448528960, 18205761, 3930688576, 2891648067, 279645250, 221785157, 884304968, 2337451080, 289066063, 2215881811, 267848795, 2884881507, 756100196, 1287302246, 40103016, 494619756, 2492476525, 500403310, 32812146, 2758364275, 340528245, 33303670, 168914039, 1379413123, 375721095, 1497853063, 785706121, 314838151, 418286734, 1024838798, 189738131, 50662551, 239053977, 139807908, 386288806, 3338972327, 63851691, 2677214379, 399862957, 2301029550, 110816431, 363588786, 25939123, 2545175738, 17665210, 2491845824, 21875907, 1684597956, 19983556, 233630926, 4903701712, 2887044304, 1056525523, 254708948, 3011275989, 171207894, 3068595414, 2343939284, 120466650, 763653342, 318393568, 35900643, 241634539, 84454644, 189140215, 2442095866, 26676475, 18926843, 22179069, 2773085439, 16076032, 39308549, 167210247, 2897136909, 140389647, 1704389904, 355192080, 114330902, 108989719, 21933334, 54291739, 50769180, 429182236, 293121307, 37039388, 1482157344, 51883297, 978881826, 3333352732, 2797227300, 208842021, 2653539623, 897690919, 2953162027, 20958510, 21015868, 75771199, 2461887810, 21359940, 20335940, 52505924, 757656906, 2305805642, 807251274, 47983954, 844385623, 1007496540, 1611500893, 1961848159, 21359969, 133033315, 360131942, 23580008, 1249578344, 78974318, 521416047, 24399217, 2316127604, 1621208437, 524103030, 1630817652, 44772728, 95309175, 2999078270, 2447625602, 292777349, 2635033989, 167030157, 2319494544, 2170178961, 3410218392, 997707163, 2720435616, 1630793124, 2729037229, 234892719, 343051698, 18517432, 491990457, 454249913, 29797819, 3225611708, 223989188, 30313925, 125636043, 372665807, 2163076560, 14790095, 137031123, 2427440598, 10153432, 55791066, 1639206362, 243666396, 480906719, 2303897060, 370388457, 403500523, 1035505135, 2903166449, 176614899, 197234165, 316485110, 24243704, 3108351, 3057643017, 774950412, 701836814, 2614865423, 173665812, 15486485, 376303126, 187223572, 398143007, 2804059680, 116346402, 288755234, 1118228005, 198012457, 30010923, 2470325805, 34041396, 113126965, 871140918, 47681084, 947605070, 331443800, 3239915102, 161115748, 23088741, 961359462, 559500904, 431369833, 412749418, 203615850, 62885484, 562277996, 62459498, 441298550, 271036023, 706137724, 615820924, 963358334, 256102016, 67849864, 89116299, 437112464, 266653330, 242151073, 165113512, 37932713, 180063915, 286494380, 19066543, 2417880752, 400060082, 34385593, 1099124418, 926330563, 567733956, 627437253, 724430534, 50515656, 766013130, 2156744395, 25235151, 14831312, 2269302482, 2675216088, 76017373, 796266210, 2163437282, 280727266, 19091173, 52088553, 373415933, 530984698, 17886974, 158183167, 231837439, 317632257, 158060289, 391933694, 116559622, 604663560, 377089800, 70717194, 7900962, 2178404130, 32321318, 431476522, 26677034, 737578796, 29847346, 79712052, 26029878, 453332790, 14855994, 267538236, 34082620, 3293261630, 1593970495, 2700865349, 56938314, 974425932, 194981709, 306835278, 14511951, 27324239, 3118927695, 1604693838, 2409140051, 109031255, 95514456, 1434693463, 79646557, 367316830, 289836894, 27291488, 34058084, 33116005, 18386792, 17469289, 2228703083, 384511853, 42987373, 22728561, 84963186, 221769589, 241536891, 416051069, 39440257, 446492547, 304050052, 2371481478, 1246711687, 278163334, 123670413, 632729497, 333598618, 855347106, 766848930, 44945327, 47239089, 3331313585, 132911028, 1485008827, 4184313789, 335048637, 33927104, 407498690, 19509191, 301248462, 23195603, 801050580, 35344342, 416632791, 9244632, 26611674, 1321701348, 573190121, 337203179, 2249904109, 2707984366, 476172271, 223227888, 136114159, 5402612, 1138487286, 255340540, 1564782590, 707433194556166144, 717483070249537536, 710017296140357632, 703936787102593024, 707310778055929856, 722484814302081025, 708833053976760320, 705835155970199552, 1138782216, 706875005318139904, 710907982847021058, 709844765404168193, 2433667077, 1355075588, 858411013, 93900816, 38531090, 158969879, 197652505, 361885723, 17780763, 3037523999, 3090403366, 77336615, 26513449, 18378801, 3228692530, 417869882, 708522042, 322768954, 252629056, 15650882, 88944711, 19001417, 276353099, 30183502, 407367760, 3546746962, 175370325, 362328150, 22532186, 632934491, 2211205212, 1275228253, 534745180, 1023160417, 948670562, 62959723, 3217821804, 105607277, 1331720306, 8736882, 28086388, 40726645, 150548599, 1372786812, 374821000, 3383922831, 4063178898, 14184598, 1099542679, 2222837913, 22179997, 551530663, 191574187, 99414195, 807095, 1090556088, 434655422, 459018431, 41111747, 466645191, 123171022, 558354638, 372773073, 1388212436, 79614164, 531984600, 487600344, 2891911385, 45773023, 452751590, 160674024, 19173608, 30699754, 598003947, 19869928, 377876712, 3088462067, 1187647735, 3221360889, 1161687290, 408867067, 382300412, 533287165, 65917182, 23007492, 1270952198, 1942819082, 479858958, 1694134544, 1665839389, 147181854, 521580831, 356454691, 223252782, 58511662, 940503344, 17387823, 142414128, 14168372, 785223992, 50499897, 930672954, 21172539, 257708359, 2984972620, 1088057682, 388305236, 1872245078, 330510681, 25948511, 19845473, 50893154, 177607011, 241316195, 36852069, 236466533, 415175014, 1025642856, 58380642, 106525027, 414552429, 2411041133, 3369234799, 2307305846, 3368620407, 4415377784, 546238840, 47657344, 541421953, 16028034, 706647360835694592, 3071570304, 159052174, 1564676498, 51999125, 496644502, 345272730, 264360346, 80736668, 386699681, 118501799, 202715565, 67293615, 1152897456, 130617778, 624071090, 4190499257, 1252078010, 119083451, 71553469, 453882302, 54211009, 57528773, 115380678, 395604421, 56095174, 1328435660, 69071310, 213291472, 56037843, 11866582, 15135191, 380285402, 188871130, 27734496, 840659424, 1548767714, 221188580, 25088495, 15069680, 538653170, 424759795, 134033909, 183620089, 2155827710, 142520831, 163131909, 6017542, 47280650, 2799276557, 33706512, 1410658832, 386265621, 1280643612, 2596123165, 342471196, 268751392, 165458471, 326292008, 535589416, 2267206189, 3312529965, 22311472, 99455537, 2258342448, 14160437, 15143478, 2779009591, 8131132, 838210111, 843575874, 395645508, 225235528, 343790153, 2788225609, 2407985737, 78148172, 254800462, 79188561, 18772564, 567456343, 29995610, 162583131, 2978525789, 1390621278, 126423647, 2434191967, 184537698, 325227115, 707646062, 2743341684, 1325634169, 3497865853, 50164350, 732586320724250624, 2850419329, 15012486, 2292134538, 601862797, 2209510030, 30110352, 2998432401, 3031061138, 131551901, 138556065, 599241381, 224432813, 762475182, 217879220, 573862580, 67302075, 3125392064, 555569860, 15553222, 1244639942, 594244296, 570127050, 80622283, 34386645, 1400943320, 791081695, 607695586, 127111907, 56300259, 2485605095, 2293109486, 158102256, 822170360, 170488570, 2468295422, 742143, 322097919, 745874875466801152, 17593090, 2342621959, 175174416, 438203162, 45019930, 104002334, 2847937319, 734196524, 1532334896, 119534385, 1058493241, 352023354, 2296730443, 1865954130, 420123474, 810898260, 267383636, 138859351, 51237727, 11350892, 2510877549, 25949039, 62894963, 198726518, 75797367, 21533567, 23892865, 17617795, 3176428420, 322401157, 27186055, 1691497362, 2149913492, 474076059, 774558624, 1018205090, 187315110, 576369575, 49632169, 112636850, 1688957876, 404583350, 364008378, 335770556, 73774016, 305796032, 16135106, 376501193, 265286602, 780563401, 18502607, 170030033, 317887448, 1604285401, 16552921, 793572312, 113415132, 219370462, 1261040611, 40629220, 15954917, 2889503717, 194892775, 16716776, 976901094, 109302759, 1673909227, 598701030, 195507181, 441644014, 228332540, 2219955198, 2337428480, 321098753, 2737705985, 2993848320, 170357763, 18658312, 3217871882, 56824850, 18658330, 41317402, 234443808, 18215973, 4658697254, 524047399, 16184358, 1120089133, 410219569, 748008500, 336958516, 31388726, 360010806, 375723065, 319444026, 15438913, 446657603, 146240579, 3496506439, 269399115, 2333701195, 621335628, 2913055823, 54088791, 3091059805, 2376995933, 1459033188, 1478538348, 498095215, 278303858, 443905140, 4899476600, 378115192, 767988860, 551433344, 338744449, 186569856, 518747268, 245437573, 565990533, 211612807, 455054472, 17921160, 458658954, 261166218, 860574864, 1579488404, 23098517, 408237214, 129905825, 406443172, 546215079, 406353065, 18568363, 23966894, 377803954, 1025365177, 1457976506, 69768385, 1368601795, 234927299, 586052805, 337466567, 435360967, 248313034, 1109767370, 2375955662, 895349966, 38540494, 44135635, 3086267604, 172578007, 560346328, 24581337, 1087648986, 2751075544, 2702193884, 570946780, 42947806, 2530776284, 2740262113, 2544366819, 15250661, 210408678, 2530039015, 14275816, 392942835, 2805904639, 503559430, 3065492744, 2167674121, 705713418, 581276943, 2460308757, 311489814, 335500572, 2612491549, 17995040, 999453985, 2504144162, 598103332, 515855657, 505238832, 3022443825, 577434930, 377779512, 398832960, 336827713, 371307842, 1485403460, 2166723912, 201930058, 38942027, 3028907347, 517854550, 35460439, 516846940, 1247843678, 14546282, 222213485, 3540252020, 2541974903, 227915129, 985675130, 3194885499, 196220287, 708697173689413632, 859952515, 11203972, 4826510725, 15693190, 36320648, 33133961, 2377815434, 36730252, 274331022, 100332944, 49616273, 3312965018, 1858696603, 376927648, 2251445666, 293098914, 33133988, 27366826, 16037293, 486110640, 814347697, 436360631, 421139897, 70522299, 715519424, 185505217, 68163020, 1952216526, 759251, 529544659, 48887254, 56669655, 52327900, 373331421, 2196059614, 341358046, 198686176, 3332044263, 20772329, 739120620, 2746979823, 243004913, 29357555, 329446900, 381744634, 120903164, 61199871, 264418829, 29464077, 798651920, 3147036178, 558937618, 61388307, 506033683, 836285976, 46183961, 2654901794, 962958890, 715044396, 299800115, 156464691, 36386357, 16553523, 1639118395, 53507648, 451712585, 2160162379, 316806731, 3078018642, 423908947, 26900055, 48379479, 505575001, 459798109, 1489204830, 403715681, 571962978, 194139747, 1369896548, 2282813029, 44660324, 1017796195, 16709228, 3379164785, 2567730801, 3248330356, 828151412, 2885523061, 301233784, 636483193, 363296379, 2330916476, 17233536, 560617089, 177903234, 41145987, 2317342343, 189625992, 862221962, 866162317, 3842340493, 2935420557, 257332880, 44832407, 3408893594, 148551326, 126867103, 49690284, 4544132784, 1264965296, 3114325683, 365016756, 28473012, 2373605047, 340309688, 16930489, 51066561, 49026755, 920000198, 16193222, 318518982, 154621647, 2471573202, 394147539, 3616667353, 24385241, 553719515, 17446621, 354981602, 141670116, 1365964518, 373569258, 446142187, 350975722, 2956900080, 4438513393, 267073265, 535918324, 3092625141, 32560887, 33756927, 2618513153, 836844602, 698609712699465729, 109065990, 1046001414, 205797129, 2193094410, 117495572, 981956377, 2184574752, 491960101, 28931885, 2187007790, 475690797, 13850422, 3191781175, 438884150, 518567734, 471439163, 1652541, 3384317758, 377444162, 216299334, 3004231, 1492252490, 29824845, 331257682, 102258516, 51525478, 2883016551, 972651, 93722476, 158152557, 834672494, 375732085, 56825720, 2769459065, 724660166663139328, 834328459, 1412528011, 188479380, 1239799700, 2488367000, 14186393, 1011414938, 513775515, 146741156, 632600488, 4970411, 247412653, 331659184, 1093826480, 4839012274, 42235831, 2851157944, 18388923, 531584958, 205789121, 87340999, 1107277770, 3077715918, 117110737, 385742803, 191821780, 78067670, 17561562, 31373289, 58562538, 3320453099, 24467440, 16807921, 18970609, 2803103732, 885741559, 47052792, 180525056, 573061135, 18085903, 3535919123, 729290779, 124811295, 1419761696, 316602406, 54974504, 1058502702, 14563376, 140269619, 35469364, 248248377, 370702394, 327178297, 1577203772, 59988031, 159930435, 1173993540, 101128259, 17004618, 3012851800, 52779100, 111556701, 40212578, 55580770, 326309990, 25270376, 366532713, 1123268714, 557070443, 334076013, 15112305, 612473, 758683771, 14669951, 232953988, 558176390, 90036360, 3381377163, 359938190, 480778384, 1466415254, 424007831, 3407845527, 73922714, 3375020193, 1075460258, 1338611875, 557840546, 29210791, 2925426858, 191748266, 368793771, 366819502, 3057359022, 48265392, 130496691, 195115190, 4444526777, 203086009, 102455486, 2895550656, 14940354, 605616323, 2183698628, 150804677, 33822918, 329857224, 474249417, 18880715, 2220824783, 31250639, 24836305, 2475489490, 1087764690, 4785240276, 236787928, 1714575576, 1080408283, 38607067, 1469937889, 405125354, 101947630, 406313202, 49223928, 550557945, 624195834, 592206075, 44398844, 30973, 41728251, 335116543, 107583743, 785930497, 2233383175, 3780385032, 1465997580, 2448406796, 18602254, 276764943, 401799440, 234182929, 231102738, 26695954, 2909632792, 563591448, 592222488, 295344416, 2721855787, 1291770157, 533764397, 380041517, 24574264, 710375742, 14293310, 304691522, 868112707, 180132166, 574855496, 2169157965, 3413932366, 262199631, 220895572, 153147735, 385194334, 2440681825, 101570917, 1571502440, 3221002602, 49117549, 3003971951, 304404850, 30095732, 581507445, 13171062, 468539772, 60643715, 28039563, 727472528, 1651988881, 3214784915, 15669672, 407157161, 3219143081, 431364524, 195000753, 116914610, 145537458, 419731891, 261241269, 1166449088, 626063811, 2546760132, 412096966, 2882255303, 1515436488, 171530695, 20748745, 4847327697, 172743125, 1415789017, 18807262, 19487198, 2882787813, 42678760, 989723112, 18643437, 2166471150, 23173615, 1112209904, 15374834, 119233012, 37337589, 352532987, 2919053820, 358545917, 72882689, 33331713, 43293189, 20937227, 9648652, 242047504, 195967506, 487209491, 292174359, 18201114, 470407707, 535829025, 524327466, 83622448, 433494577, 267958833, 208083510, 36756025, 387291709, 176151102, 120306239, 481098307, 617609801, 3810056789, 885733974, 256596567, 91478624, 268606051, 445528675, 3189340776, 1177737834, 248232554, 409713262, 3017734767, 211950197, 1704499831, 3193944696, 581024377, 431340154, 1149467262, 406575743, 1297087104, 237850624, 900684421, 23272075, 7076492, 1642519183, 8936082, 28695188, 278977178, 263436955, 467810972, 365353631, 3007576735, 62954145, 105912996, 15841958, 2440215209, 405412526, 369302191, 1340299952, 258235055, 2486041270, 1033878199, 19421879, 3131316923, 248134334, 3416144579, 1945524931, 4867783367, 3236436679, 281590472, 217553611, 60627661, 14662354, 38845139, 29997780, 628873951, 2505808614, 132135657, 621951726, 3386530551, 162749178, 25975551, 4826979073, 112614146, 208313090, 531798788, 227834632, 241056520, 2381462282, 487381770, 102505231, 20708112, 370187032, 121969438, 44735263, 43514656, 60259105, 491461409, 28302111, 52247328, 2437806886, 1590106934, 2225044282, 322411325, 37583680, 3870956354, 2726583108, 2918021962, 28785486, 597859152, 1020058453, 2337307478, 291486552, 393190233, 51207002, 477092700, 2538003293, 234445663, 370178912, 244267877, 42212199, 1338047336, 402881389, 844364659, 305208192, 35388291, 1713904518, 2838100870, 47455112, 3043498889, 4871789453, 358857615, 3314137999, 790395794, 16374678, 2796706711, 595106712, 706493340, 3189848989, 101596065, 14711728, 129235890, 918346674, 243628984, 2624297914, 1468201914, 1048959938, 22076359, 2190703560, 226761671, 612752338, 396254162, 4073716692, 74644440, 356285402, 2887932892, 51346400, 47447010, 1211743207, 290888679, 81148908, 165108730, 47553531, 321428477, 2923469833, 189283341, 956218382, 59513871, 2532817934, 221707278, 991714320, 762043412, 2573114393, 806075419, 315161628, 323583005, 132987936, 1293155360, 435362857, 206797866, 2850249772, 38468656, 3545938995, 3337804853, 3081362486, 589577269, 245038137, 2879986746, 1547377722, 39640124, 4884913213, 457784381, 3239345215, 1135246400, 2214755390, 444169282, 237403203, 2371238981, 27671624, 19364942, 30039119, 2571164752, 901733456, 358145106, 1335262297, 18013279, 246578276, 190012527, 85646449, 3683548276, 71056501, 33021046, 260250743, 8215672, 1723382906, 1613651070, 380648579, 257555592, 34348169, 87989388, 1894005900, 304626831, 232520849, 3995950227, 581164183, 2951412888, 325311641, 5741722, 59055257, 1408769192, 172244137, 341310633, 214809773, 15162541, 35650736, 1084636346, 261004480, 247995585, 170515650, 221232323, 567295169, 102325442, 16407750, 24460492, 17759437, 584031440, 3178323153, 3242884304, 72088788, 1137881, 349060315, 71654624, 2783436006, 22666472, 91593963, 32554220, 47766764, 202415340, 1321393400, 25189625, 97139962, 3196804345, 479845628, 65928449, 224263426, 33348868, 33529092, 861175045, 128146697, 393469195, 151313675, 2282700048, 2937396502, 32652567, 450919703, 176200983, 198065433, 301628699, 154017052, 549477661, 2562006302, 635608354, 2508872994, 8953122, 403381541, 203373866, 2678693164, 459840813, 902135084, 304061756, 227089726, 454909257, 1046289739, 3317955934, 809680224, 400670062, 55328112, 625532273, 100818295, 197950842, 166002047, 24165761, 2337029510, 22838664, 430423444, 74358167, 22920602, 131538331, 14253469, 3090939294, 14138785, 231579043, 2943024549, 1152032174, 630799797, 82517438, 17243582, 111418816, 860536260, 244645317, 885972421, 2556018119, 279076294, 35913161, 316661202, 221986261, 806837718, 25451991, 2194546141, 18939358, 141270494, 302783968, 35102180, 2882477540, 890691050, 1367531, 16211434, 77250035, 991469046, 94559734, 271564284, 3141672447, 2178375167, 178232832, 862502400, 838655492, 290283013, 21134853, 92995077, 164527624, 3422739981, 13049362, 868580882, 4784971284, 16973333, 111197718, 71048726, 3232497177, 250240542, 206437921, 238427684, 617192998, 2393988648, 253681200, 1834483249, 1855372849, 3410689588, 255204918, 3279797823, 709975616, 20061764, 2425732679, 2489433674, 1674296911, 19226193, 42761813, 75365979, 2931433052, 54222429, 29818460, 3649461854, 2318442088, 1351949928, 272301678, 2871246446, 61234799, 39140979, 17718903, 244473467, 4480261757, 4420206209, 16318082, 16424579, 275742340, 264265349, 823656079, 1970986640, 426802833, 1002954386, 228794007, 178159266, 724410019, 1973870245, 186097318, 1064238763, 745553581, 339426994, 2196201139, 3407879860, 282812085, 70860468, 418881203, 26345146, 3345915579, 629759676, 213966526, 19881665, 1953865418, 882400976, 560619217, 3225108177, 2987802323, 1027530452, 1532731093, 605822673, 5988062, 1061781217, 1310760673, 747822822, 25255655, 2766716657, 394403582, 171171584, 111582977, 297369350, 94101256, 21831433, 34004746, 216842005, 612114198, 440287004, 41541406, 230235935, 3315408672, 19504935, 1010171689, 3276054314, 1596227372, 1330257709, 2316246829, 398360367, 1948262191, 2894176053, 2275917627, 21684027, 112598847, 14294848, 345169732, 1963441988, 778057, 15327050, 246243146, 91070289, 2261753683, 1187127126, 485678934, 29417304, 199876442, 477290331, 368090980, 1537236842, 69328749, 317284206, 89325423, 943210351, 2976628595, 26787703, 14499704, 415776636, 24493951, 180887425, 2527387525, 2495610757, 51535753, 2382913417, 49340299, 2717351818, 824754061, 427843469, 544317327, 22454160, 36151185, 87416722, 39755667, 429227921, 120889238, 26492823, 634134424, 750215064, 594886554, 321716129, 18071459, 37248934, 347627434, 1059528620, 457867181, 17579955, 216776631, 22077368, 478273463, 19783607, 3113598907, 1598644159, 1129807808, 29065153, 33611715, 317882310, 11616202, 271220683, 27246538, 69361622, 473522137, 23896029, 3293118434, 2998771683, 30244836, 953122789, 270688230, 34349031, 2717876204, 42958829, 273612783, 64643056, 34160624, 42696696, 2232352763, 277807101}

    
    
    ten_percent = int(1 * len(rumor_cascade))
    subset = rumor_cascade[:ten_percent]
    right_num = 0
    all_num = 0
    for index, test_cascade in enumerate(subset):
        print(index)
        bot_info_dict = {}
        
        bots_in_cascade = set(test_cascade.nodes()).intersection(bots)

        for bot in bots_in_cascade:
            
            infection_time = test_cascade.nodes[bot]['time']
            feature_profile = test_cascade.nodes[bot]['att']

            
            infected_by = list(test_cascade.in_edges(bot))

            
            bot_info_dict[bot] = {
                'infection_time': infection_time,
                'feature_profile': feature_profile,
                'infected_by': infected_by
            }


        
        sorted_bots = sorted(bot_info_dict.keys(), key=lambda x: bot_info_dict[x]['infection_time'])
        O_Y = set(sorted_bots[:4])

        O_M = set(sorted_bots[4:])
        O_N = bots - O_Y - O_M

        
        bot_useful_info_dict = {bot: bot_info_dict[bot] for bot in O_Y}
        bot_unuseful_info_dict = {bot: bot_info_dict[bot] for bot in O_M}

 
        
        source_node = list(test_cascade.nodes())[0]
        pred_source = source_localization(union_graph_inf, bot_useful_info_dict, O_Y, O_M, None)
        if pred_source != -999:
            all_num = all_num + 1
            print('source_node: ', source_node)
            print('pred_node: ', pred_source)
            print('------------------------------------------------------------------------------')
            if source_node == pred_source:
                right_num = right_num + 1
    
    
    print('The lowest bound F-score: ', right_num/all_num)
